{"version":3,"file":"courses.min.js","sources":["../src/courses.js"],"sourcesContent":["define([\n    'local_courses/jquery.dataTables',\n    'jquery','core/str','core/modal_factory', 'core/ajax'\n], function(DataTable, $,Str,ModalFactory, Ajax){\n    return courses = {\n        load : function() {\n        },\n        usersdatatable : function(args) {\n            console.log(args);\n            params = [];\n            params.action = args.action;\n            params.courseid = args.courseid;\n            params.moduletype = args.moduletype;\n\t\t\tStr.get_strings([{\n                key: 'search',\n                component: 'local_courses'\n            },\n            {\n                key: 'no_users_enrolled',\n                component: 'local_courses'\n            }]).then(function(s) {\n                var oTable = $('#course_users').dataTable({\n                    'bInfo': false,\n                    'processing': true,\n                    'serverSide': true,\n                    'ordering': false,\n                    'ajax': {\n                        \"type\": \"POST\",\n                        \"url\": M.cfg.wwwroot + '/local/courses/ajax.php',\n                        \"data\": params\n                    },\n                    \"bLengthChange\": false,\n                    \"language\": {\n                        \"paginate\": {\n                            \"next\": \">\",\n                            \"previous\": \"<\"\n                        },\n                        'processing': '<img src='+M.cfg.wwwroot + '/local/ajax-loader.svg>'\n                    },\n                    \"oLanguage\": {\n                      \"sSearch\" : s[0],\n        \t\t\t  \"sZeroRecords\": s[1]\n                    },\n                });\n\t\t\t});\n        },\n        deleteuser: function(element) {\n            var enrollmentid = element.userid;\n            // console.log(element);\n            return Str.get_strings([{\n                key: 'deleteuser',\n                component: 'local_courses'\n            }, {\n                key: 'confirmdelete',\n                component: 'local_courses'\n            }]).then(function(s) {\n                ModalFactory.create({\n                    title: s[0],\n                    type: ModalFactory.types.DEFAULT,\n                    body: s[1],\n                    footer: '<button type=\"button\" class=\"btn btn-primary\" data-action=\"save\">'+M.util.get_string(\"yes\", \"moodle\")+'</button>&nbsp;' +\n                    '<button type=\"button\" class=\"btn btn-secondary\" data-action=\"cancel\">'+M.util.get_string(\"no\", \"moodle\")+'</button>'\n                }).done(function(modal) {\n                    this.modal = modal;\n                    modal.getRoot().find('[data-action=\"save\"]').on('click', function() {\n                        window.location.href ='enrolledusers.php?id='+element.id+'&ue='+element.userid+'&confirm=1&sesskey=' + M.cfg.sesskey;\n                    }.bind(this));\n                    modal.getFooter().find('[data-action=\"cancel\"]').on('click', function() {\n                        modal.setBody('');\n                        modal.hide();\n                    });\n                    modal.show();\n                }.bind(this));\n            }.bind(this));\n        },\n           regeneratecertificate: function(element) {\n            var enrollmentid = element.issueid;\n            // console.log(element);\n            return Str.get_strings([{\n                key: 'regeneratecertificate',\n                component: 'local_courses'\n            }, {\n                key: 'confirmregenerate',\n                component: 'local_courses'\n            }]).then(function(s) {\n                ModalFactory.create({\n                    title: s[0],\n                    type: ModalFactory.types.DEFAULT,\n                    body: s[1],\n                    footer: '<button type=\"button\" class=\"btn btn-primary\" data-action=\"save\">'+M.util.get_string(\"yes\", \"moodle\")+'</button>&nbsp;' +\n                    '<button type=\"button\" class=\"btn btn-secondary\" data-action=\"cancel\">'+M.util.get_string(\"no\", \"moodle\")+'</button>'\n                }).done(function(modal) {\n                    this.modal = modal;\n                    modal.getRoot().find('[data-action=\"save\"]').on('click', function() {\n                         element.confirm = true;\n                         var params ={};\n                         params.id= element.issueid;\n                        var promise = Ajax.call([{\n                            methodname: 'tool_certificate_regenerate_issue_file',\n                            args:params\n                        }]);\n                        promise[0].done(function() {\n                            window.location.href = window.location.href;\n                        }).fail(function(ex) {\n                            // do something with the exception\n                             console.log(ex);\n                        });\n                    }.bind(this));\n                    modal.getFooter().find('[data-action=\"cancel\"]').on('click', function() {\n                        modal.setBody('');\n                        modal.hide();\n                    });\n                    modal.show();\n                }.bind(this));\n            }.bind(this));\n        },\n        enrollUsers: function (args) {\n            // console.log(args);return;\n            return Str.get_strings([{\n                key: 'confirm'\n            },\n            {\n                key: 'enrolluserstocourse',\n                component: 'local_courses',\n                param: args\n            }]).then(function (s) {\n                ModalFactory.create({\n                    title: s[0],\n                    type: ModalFactory.types.DEFAULT,\n                    body: s[1],\n                    footer: '<button type=\"button\" class=\"btn btn-primary\" data-action=\"save\">Yes</button>&nbsp;' + \n                    '<button type=\"button\" class=\"btn btn-secondary\" data-action=\"cancel\">No</button>'\n                }).done(function (modal) {\n                    this.modal = modal;\n\n                    modal.getRoot().find('[data-action=\"save\"]').on('click', function () {\n                        window.location.href = M.cfg.wwwroot+ '/local/courses/courseautoenrol.php?confirmation=1&id='+args.courseid;\n                    }.bind(this));\n                    modal.getFooter().find('[data-action=\"cancel\"]').on('click', function () {\n                        modal.setBody('');\n                        modal.hide();\n                    });\n                    modal.show();\n                }.bind(this));\n            }.bind(this));\n        },\n    };\n    \n});\n"],"names":["define","DataTable","$","Str","ModalFactory","Ajax","courses","load","usersdatatable","args","console","log","params","action","courseid","moduletype","get_strings","key","component","then","s","dataTable","bInfo","processing","serverSide","ordering","ajax","type","url","M","cfg","wwwroot","data","bLengthChange","language","paginate","next","previous","oLanguage","sSearch","sZeroRecords","deleteuser","element","userid","create","title","types","DEFAULT","body","footer","util","get_string","done","modal","this","getRoot","find","on","window","location","href","id","sesskey","bind","getFooter","setBody","hide","show","regeneratecertificate","issueid","confirm","call","methodname","fail","ex","enrollUsers","param"],"mappings":"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"}