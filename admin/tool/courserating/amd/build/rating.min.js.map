{"version":3,"file":"rating.min.js","sources":["../src/rating.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle. If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Manage the courses view for the overview block.\n *\n * @module     tool_courserating/rating\n * @copyright  2022 Marina Glancy <marina.glancy@gmail.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {get_string as getString} from 'core/str';\nimport {add as addToast} from 'core/toast';\nimport ModalForm from \"core_form/modalform\";\nimport ModalFactory from \"core/modal_factory\";\nimport Fragment from \"core/fragment\";\nimport Templates from \"core/templates\";\nimport ModalEvents from 'core/modal_events';\nimport ajax from 'core/ajax';\n\nconst SELECTORS = {\n    COURSERATING: '.customfield_tool_courserating',\n    COURSEWIDGET: '.tool_courserating-widget',\n    ADD_RATING: '[data-action=tool_courserating-addrating][data-componentid]',\n    VIEW_RATINGS_CFIELD: '.tool_courserating-cfield .tool_courserating-ratings',\n    VIEW_RATINGS_LINK: '[data-action=\"tool_courserating-viewratings\"]',\n    FLAG_RATING: '[data-action=tool_courserating-toggleflag]',\n    DELETE_RATING: `[data-action='tool_courserating-delete-rating']`,\n    USER_RATING: `[data-for='tool_courserating-user-rating']`,\n    CFIELD_WRAPPER: `[data-for='tool_courserating-cfield-wrapper'][data-componentid]`,\n    USER_RATING_FLAG: `[data-for='tool_courserating-user-flag']`,\n    RATING_POPUP: `.tool_courserating-reviews-popup`,\n    REVIEWS_LIST: `.tool_courserating-reviews-popup [data-for=\"tool_courserating-reviews\"]`,\n    SHOWMORE_WRAPPER: `.tool_courserating-reviews-popup [data-for=\"tool_courserating-reviews\"] ` +\n        `[data-for=\"tool_courserating-showmore\"]`,\n    SHOWMORE_BUTTON: `.tool_courserating-reviews-popup [data-for=\"tool_courserating-reviews\"] ` +\n        `[data-for=\"tool_courserating-showmore\"] [data-action=\"showmore\"]`,\n    RESET_WITHRATINGS: `.tool_courserating-reviews-popup [data-for=\"tool_courserating-reviews\"] ` +\n        `[data-for=\"tool_courserating-resetwithrating\"]`,\n    POPUP_SUMMARY: `.tool_courserating-reviews-popup [data-for=\"tool_courserating-summary\"]`,\n    SET_WITHRATINGS: `.tool_courserating-reviews-popup [data-for=\"tool_courserating-summary\"] ` +\n        `[data-for=\"tool_courserating_setwithrating\"]`,\n    RBCELL: `[data-for=\"tool_courserating-rbcell\"][data-ratingid]`,\n};\n\nlet systemContextId;\nlet viewRatingsModal;\nlet addRatingModal;\n\n/**\n * Initialise listeners\n *\n * @param {Number} systemContextIdParam\n * @param {Boolean} useJQuery\n */\nexport const init = (systemContextIdParam, useJQuery = false) => {\n    systemContextId = systemContextIdParam;\n\n    document.addEventListener('click', e => {\n        if (!e || !e.target || (typeof e.target.closest === \"undefined\")) {\n            return;\n        }\n\n        const addRatingElement = e.target.closest(SELECTORS.ADD_RATING),\n            viewRatingsElement = e.target.closest(SELECTORS.VIEW_RATINGS_CFIELD),\n            deleteRatingElement = e.target.closest(SELECTORS.DELETE_RATING);\n\n        if (addRatingElement) {\n            e.preventDefault();\n            const componentid = addRatingElement.getAttribute('data-componentid');\n            const componentname = addRatingElement.getAttribute('data-componentname');\n            if (viewRatingsModal) {\n                viewRatingsModal.destroy();\n            }\n            addRating(componentid,componentname);\n        } else if (viewRatingsElement) {\n            e.preventDefault();\n            const classes = (' ' + viewRatingsElement.getAttribute('class') + ' '),\n                matches = classes.match(/ tool_courserating-ratings-componentid-(\\d+) /);\n                matchesnm = classes.match(/ tool_courserating-ratings-componentname-(\\w+) /);\n            if (matches) {\n                const widget = viewRatingsElement.closest(SELECTORS.COURSEWIDGET);\n                if (widget && widget.querySelector(SELECTORS.ADD_RATING)) {\n                    addRating(matches[1],matchesnm[1]);\n                } else {\n                    viewRatings(matches[1],matchesnm[1]);\n                }\n            }\n        } else if (deleteRatingElement) {\n            e.preventDefault();\n            const ratingid = deleteRatingElement.getAttribute('data-ratingid');\n            deleteRating(ratingid);\n        }\n    });\n\n    if (useJQuery) {\n        require(['jquery'], function($) {\n            $('body').on('updated', '[data-inplaceeditable]', e => reloadFlag(e.target));\n        });\n    } else {\n        document.addEventListener('core/inplace_editable:updated', e => reloadFlag(e.target));\n    }\n};\n\n/**\n * Update the rating flag fragment\n *\n * @param {Element} inplaceEditable\n */\nconst reloadFlag = (inplaceEditable) => {\n    if (inplaceEditable.dataset.component === 'tool_courserating' && inplaceEditable.dataset.itemtype === 'flag') {\n        const ratingid = inplaceEditable.dataset.itemid;\n        const node = document.querySelector(`${SELECTORS.USER_RATING_FLAG}[data-ratingid='${ratingid}']`);\n        if (node) {\n            Fragment.loadFragment('tool_courserating', 'rating_flag', systemContextId, {ratingid}).done((html, js) => {\n                Templates.replaceNode(node, html, js);\n            });\n        }\n    }\n};\n\n/**\n * Add ratings dialogue\n *\n * @param {Number} componentid\n */\nconst addRating = (componentid,componentname) => {\n    addRatingModal = new ModalForm({\n        formClass: 'tool_courserating\\\\form\\\\addrating',\n        args: {componentid,componentname},\n        modalConfig: {\n            title: getString('addrating', 'tool_courserating'),\n        },\n    });\n\n    // When form is saved, refresh it to remove validation errors, if any:\n    addRatingModal.addEventListener(addRatingModal.events.FORM_SUBMITTED, () => {\n       // getString('changessaved')\n         window.location.reload()\n            .then(addToast)\n            .catch(null);\n        refreshRating(componentid,componentname);\n    });\n\n    addRatingModal.show();\n};\n\n/**\n * View ratings dialogue\n *\n * @param {Number} componentid\n */\nconst viewRatings = (componentid,componentname) => {\n    ModalFactory.create({\n        type: ModalFactory.types.CANCEL,\n        title: getString(componentname, 'tool_courserating'),\n        large: true,\n        buttons: {\n            cancel: getString('closebuttontitle', 'core'),\n        },\n        removeOnClose: true,\n    })\n        .then(modal => {\n            modal.setLarge();\n            loadCourseRatingPopupContents({componentid,componentname})\n            .done(({html, js}) => {\n                modal.setBody(html);\n                Templates.runTemplateJS(js);\n            });\n            // Handle hidden event.\n            modal.getRoot().on(ModalEvents.hidden, function() {\n                // Destroy when hidden.\n                modal.destroy();\n            });\n            modal.show();\n            viewRatingsModal = modal;\n            return modal;\n        })\n        .fail(() => null);\n};\n\n/**\n * Delete rating with specified id\n *\n * @param {Number} ratingid\n */\nconst deleteRating = (ratingid) => {\n    const form = new ModalForm({\n        formClass: 'tool_courserating\\\\form\\\\deleterating',\n        args: {ratingid},\n        modalConfig: {\n            title: getString('deleterating', 'tool_courserating'),\n        },\n    });\n\n    // When form is saved, rating should be deleted.\n    form.addEventListener(form.events.FORM_SUBMITTED, async e => {\n        const el = document.querySelector(SELECTORS.USER_RATING + `[data-ratingid='${e.detail.ratingid}'`);\n        if (el) {\n             el.remove();\n             window.location.reload();\n             viewRatingsModal.destroy();\n          \n        }\n        refreshRating(e.detail.componentid,e.detail.componentname);\n        if (!el) {\n            const rbcell = document.querySelector(SELECTORS.RBCELL + `[data-ratingid='${e.detail.ratingid}'`);\n            if (rbcell) {\n                rbcell.innerHTML = await getString('ratingdeleted', 'tool_courserating');\n            }\n        }\n    });\n\n    form.show();\n};\n\n/**\n * Refresh course rating summary\n *\n * @param {Number} componentid\n */\nconst refreshRating = (componentid,componentname) => {\n\n    let el1 = document.getElementsByClassName('tool_courserating-ratings-componentid-' + componentid);\n    if (el1 && el1.length) {\n        const cfield = el1[0].closest(SELECTORS.COURSERATING);\n        Fragment.loadFragment('tool_courserating', 'cfield', systemContextId, {componentid,componentname}).done((html, js) => {\n            Templates.replaceNode(cfield, html, js);\n        });\n    }\n\n    const el2 = document.querySelector(SELECTORS.CFIELD_WRAPPER + `[data-componentid='${componentid}'][data-componentname='${componentname}']`);\n    if (el2) {\n        \n        Fragment.loadFragment('tool_courserating', 'cfield', systemContextId, {componentid,componentname}).done((html, js) => {\n            el2.innerHTML = '';\n            Templates.appendNodeContents(el2, html, js);\n        });\n    }\n\n    const el3 = document.querySelector(`[data-for='tool_courserating-summary'][data-componentid='${componentid}'][data-componentname='${componentname}']`);\n    if (el3) {\n        Fragment.loadFragment('tool_courserating', 'course_ratings_summary', systemContextId, {componentid,componentname}).done((html, js) => {\n            window.location.reload();\n            //el3.innerHTML = '';\n           // Templates.appendNodeContents(el3, html, js);\n        });\n    }\n};\n\n/**\n * Adds or removes CSS class to/from an element\n *\n * @param {Element} ratingFormGroup\n * @param {String} value\n */\nconst setFormGroupClasses = (ratingFormGroup, value) => {\n    const addRemoveClass = (className, add) => {\n        if (add && !ratingFormGroup.classList.contains(className)) {\n            ratingFormGroup.classList.add(className);\n        } else if (!add && ratingFormGroup.classList.contains(className)) {\n            ratingFormGroup.classList.remove(className);\n        }\n    };\n    for (let i = 1; i <= 5; i++) {\n        addRemoveClass('s-' + i, i <= parseInt(value));\n    }\n    addRemoveClass('tool_courserating-norating', parseInt(value) === 0);\n};\n\n/**\n * Sets up listeneres for the addRating modal form\n *\n * @param {String} grpId\n */\nexport const setupAddRatingForm = (grpId) => {\n    const ratingFormGroup = document.getElementById(grpId);\n    const curchecked = ratingFormGroup.querySelector('input:checked');\n    setFormGroupClasses(ratingFormGroup, curchecked ? curchecked.value : 0);\n\n    let els = ratingFormGroup.querySelectorAll('input');\n    for (let i = 0; i < els.length; i++) {\n        els[i].addEventListener('change', e => setFormGroupClasses(ratingFormGroup, e.target.value));\n    }\n\n    let labels = ratingFormGroup.querySelectorAll('label');\n    for (let i = 0; i < labels.length; i++) {\n        labels[i].addEventListener(\"mouseover\", e => {\n            const el = e.target.closest('label').querySelector('input');\n            setFormGroupClasses(ratingFormGroup, el.value);\n        });\n        labels[i].addEventListener(\"mouseleave\", () => {\n            const el = ratingFormGroup.querySelector('input:checked');\n            setFormGroupClasses(ratingFormGroup, el ? el.value : 0);\n        });\n    }\n\n    const form = ratingFormGroup.closest('form');\n    const viewratingsLink = form.querySelector(SELECTORS.VIEW_RATINGS_LINK);\n    if (viewratingsLink) {\n        viewratingsLink.addEventListener('click', e => {\n            e.preventDefault();\n            addRatingModal.modal.destroy();\n            viewRatings(e.target.dataset.componentid,e.target.dataset.componentname);\n        });\n    }\n};\n\n/**\n * Sets up the \"View course ratings\" popup\n */\nexport const setupViewRatingsPopup = () => {\n    const el = document.querySelector(SELECTORS.REVIEWS_LIST);\n    const reloadReviews = (offset = 0) => {\n        const params = {\n            componentid: el.dataset.componentid,\n            component: el.dataset.componentname,\n            offset,\n            withrating: el.dataset.withrating\n        };\n        return Fragment.loadFragment('tool_courserating', 'course_reviews', el.dataset.systemcontextid, params);\n    };\n\n    el.addEventListener('click', e => {\n        const button = e.target.closest(SELECTORS.SHOWMORE_BUTTON);\n        if (button) {\n            const wrapper = button.closest(SELECTORS.SHOWMORE_WRAPPER);\n            e.preventDefault();\n            reloadReviews(button.dataset.nextoffset).done((html, js) => Templates.replaceNode(wrapper, html, js));\n        }\n        const resetLink = e.target.closest(SELECTORS.RESET_WITHRATINGS);\n        if (resetLink) {\n            e.preventDefault();\n            el.dataset.withrating = 0;\n            reloadReviews(0).done((html, js) => Templates.replaceNodeContents(el, html, js));\n        }\n    });\n\n    const elSummary = document.querySelector(SELECTORS.POPUP_SUMMARY);\n    elSummary.addEventListener('click', e => {\n        const withRatingButton = e.target.closest(SELECTORS.SET_WITHRATINGS);\n        if (withRatingButton) {\n            el.dataset.withrating = (el.dataset.withrating === withRatingButton.dataset.withrating) ?\n                0 : withRatingButton.dataset.withrating;\n            reloadReviews(0).done((html, js) => Templates.replaceNodeContents(el, html, js));\n        }\n    });\n};\n\n/**\n * Hide the custom field editor on the course edit page\n *\n * @param {String} fieldname\n */\nexport const hideEditField = (fieldname) => {\n    const s = '#fitem_id_customfield_' + fieldname;\n    let el = document.querySelector(s + '_editor');\n    if (el) {\n        el.style.display = 'none';\n        el = document.querySelector(s + '_static');\n        if (el) {\n            el.style.display = 'none';\n        }\n    }\n};\n\n\n/**\n * Loads Course Rating popup contents. Allows both loggedin and nonloggedin requests.\n *\n * @param {object} args Parameters for the callback.\n * @return {Promise} JQuery promise object resolved when the fragment has been loaded.\n */\nconst loadCourseRatingPopupContents = function(args) {\n    const isloggedin = !document.body.classList.contains('notloggedin');\n    if (isloggedin) {\n        return Fragment.loadFragment('tool_courserating', 'course_ratings_popup', systemContextId, args)\n            .then((html, js) => ({html, js}));\n    }\n\n    return ajax.call([{\n        methodname: 'tool_courserating_course_rating_popup',\n        args\n    }], undefined, false)[0]\n    .then(function(data) {\n        return {html: data.html, js: Fragment.processCollectedJavascript(data.javascript)};\n    });\n};\n"],"names":["SELECTORS","systemContextId","viewRatingsModal","addRatingModal","systemContextIdParam","useJQuery","document","addEventListener","e","target","closest","addRatingElement","viewRatingsElement","deleteRatingElement","preventDefault","componentid","getAttribute","componentname","destroy","addRating","classes","matches","match","matchesnm","widget","querySelector","viewRatings","ratingid","deleteRating","require","$","on","reloadFlag","inplaceEditable","dataset","component","itemtype","itemid","node","loadFragment","done","html","js","replaceNode","ModalForm","formClass","args","modalConfig","title","events","FORM_SUBMITTED","window","location","reload","then","addToast","catch","refreshRating","show","create","type","ModalFactory","types","CANCEL","large","buttons","cancel","removeOnClose","modal","setLarge","loadCourseRatingPopupContents","_ref","setBody","runTemplateJS","getRoot","ModalEvents","hidden","fail","form","async","el","detail","remove","rbcell","innerHTML","el1","getElementsByClassName","length","cfield","el2","appendNodeContents","setFormGroupClasses","ratingFormGroup","value","addRemoveClass","className","add","classList","contains","i","parseInt","grpId","getElementById","curchecked","els","querySelectorAll","labels","viewratingsLink","reloadReviews","offset","params","withrating","Fragment","systemcontextid","button","wrapper","nextoffset","Templates","replaceNodeContents","withRatingButton","fieldname","s","style","display","body","ajax","call","methodname","undefined","data","processCollectedJavascript","javascript"],"mappings":"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"}