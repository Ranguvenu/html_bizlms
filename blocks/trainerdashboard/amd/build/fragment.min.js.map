{"version":3,"sources":["../src/fragment.js"],"names":["define","$","Str","ModalFactory","ModalEvents","fragment","Ajax","Y","Templates","SELECTORS","ELEMENT","DATAATTRIBUTES","ELEFG","PLUGIN","METHOD","PARAMS","TRIGGERTYPE","JSONFORMDATA","Fragment","fgelement","contextid","M","cfg","id","data","pluginname","method","level","args","params","jsonformdata","JSON","stringify","triggertype","init","prototype","strings","self","stringsPromise","getStrings","type","types","SAVE_CANCEL","DEFAULT","modalPromise","create","footer","getFooter","when","then","modal","setTitle","setBody","getBody","setLarge","getRoot","on","hidden","destroy","bind","addClass","animate","setTimeout","submitlabel","setSaveButtonText","save","submitForm","submitFormAjax","show","StringData","requiredStrings","RequiredStrings","i","each","key","value","component","param","get_strings","formdata","custommethod","loadFragment","$footer","handleFormSubmissionResponse","hide","use","core_formchangechecker","reset_form_dirty_state","PluginModule","require","split","childform","handleNotifications","handleFormSubmissionFailure","e","preventDefault","formData","find","serialize","call","methodname","done","fail","body","state","height","innerHeight","html","contentPromise","render","LOADING","BACKDROP","loadingIcon","fadeIn","promise","submit","document"],"mappings":"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","sourcesContent":["/*\n* This file is a part of e abyas Info Solutions.\n*\n* Copyright e abyas Info Solutions Pvt Ltd, India.\n*\n* This trainerdashboard is free software; you can redistribute it and/or modify\n* it under the terms of the GNU General Public License as published by\n* the Free Software Foundation; either version 3 of the License, or\n* (at your option) any later version.\n*\n* This trainerdashboard is distributed in the hope that it will be useful,\n* but WITHOUT ANY WARRANTY; without even the implied warranty of\n* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n* GNU General Public License for more details.\n*\n* You should have received a copy of the GNU General Public License\n* along with this trainerdashboard.  If not, see <http://www.gnu.org/licenses/>.\n*\n* @author 2019 e abyas  <info@eabyas.com>\n*/\n/**\n * Defines form and confirmation pops (types view and confirmation pops)\n *\n * @package    block_trainerdashboard\n * @copyright  2019 e abyas  <info@eabyas.com>\n */\ndefine(['jquery',\n        'core/str',\n        'core/modal_factory',\n        'core/modal_events',\n        'core/fragment',\n        'core/ajax',\n        'core/yui',\n        'core/templates',\n        'core/notification',\n        'core/custom_interaction_events',\n        'block_trainerdashboard/trainerdashboard'],\n        function($, Str, ModalFactory, ModalEvents, fragment, Ajax, Y, Templates, Notification, CustomEvents,trainerdashboard) {\n        var SELECTORS = {\n            ELEMENT: '[data-fg]',\n        };\n        var DATAATTRIBUTES = {\n            ELEFG: 'fg',\n            PLUGIN: 'plugin',\n            METHOD: 'method',\n            PARAMS: 'params',\n            TRIGGERTYPE: 'triggertype',\n            JSONFORMDATA: 'jsonformdata',\n            \n        };\n        var Fragment = function(fgelement) {\n            this.contextid = M.cfg.contextid;\n            this.fgelement = fgelement;\n            this.id = fgelement.data('id') || 0;\n            this.pluginname = fgelement.data(DATAATTRIBUTES.PLUGIN);\n            this.method = fgelement.data(DATAATTRIBUTES.METHOD);\n            this.level = fgelement.data(DATAATTRIBUTES.ELEFG);\n            this.args = {};\n            this.args.contextid = this.contextid;\n            this.args.id = this.id;\n            var params = {};\n            if (typeof fgelement.data(DATAATTRIBUTES.PARAMS) !== 'undefined') {\n                params = fgelement.data(DATAATTRIBUTES.PARAMS);\n            }\n            if (typeof fgelement.data(DATAATTRIBUTES.JSONFORMDATA) !== 'undefined') {\n                this.args.jsonformdata =  JSON.stringify(fgelement.data(DATAATTRIBUTES.JSONFORMDATA));\n            }\n       \n            this.args.params = JSON.stringify(params);\n            this.args.triggertype = fgelement.data(DATAATTRIBUTES.TRIGGERTYPE);\n            this.init();\n        };\n\n        Fragment.prototype.contextid = -1;\n\n        Fragment.prototype.id = 0;\n\n        Fragment.prototype.level = 'c';\n\n        Fragment.prototype.strings = {};\n\n        Fragment.prototype.args = {};\n        /**\n         * [init description]\n         * @method init\n         * @return {[type]} [description]\n         */\n        Fragment.prototype.init = function () {\n            var self = this;\n            var stringsPromise = this.getStrings();\n            var type = ModalFactory.types.SAVE_CANCEL;\n            if (self.level == 'r') {\n                type = ModalFactory.types.DEFAULT;\n            }\n            if (self.level == 'vmtotaltrainings' || self.level == 'vmcmpltdtrainings' || self.level == 'vmupcmngtrainings') {\n                var modalPromise = ModalFactory.create({\n                    type: ModalFactory.types.DEFAULT,\n                    footer: this.getFooter(),\n                });\n            }else{\n                var modalPromise = ModalFactory.create({\n                    type: type,\n                });\n            }\n\n \n            $.when(stringsPromise, modalPromise).then(function(strings, modal) {\n                // Keep a reference to the modal.\n                this.modal = modal;\n                this.modal.setTitle(strings[0]);\n\n                // We want to desrtroy the form every time it is opened.\n                if (self.level == 'r') {\n                    this.modal.setBody(this.getBody());\n                    this.modal.setLarge();\n                    // We want to desrtroy the form every time it is opened.\n                    this.modal.getRoot().on(ModalEvents.hidden, function() {\n                        this.modal.destroy();\n                    }.bind(this));\n                }else if (self.level == 'vmtotaltrainings' || self.level == 'vmcmpltdtrainings' || self.level == 'vmupcmngtrainings') {\n                    this.modal.setBody(this.getBody());\n                    this.modal.setLarge();\n                    // We want to desrtroy the form every time it is opened.\n                    this.modal.getRoot().on(ModalEvents.hidden, function() {\n                        this.modal.destroy();\n                    }.bind(this));\n                }\n                else {\n\n                    self.modal.getRoot().addClass('openLMStransition');\n                   \n                    this.modal.getRoot().on(ModalEvents.hidden, function() {\n                    //this.modal.destroy();\n                    this.modal.getRoot().animate({\"right\":\"-85%\"}, 500);\n                    setTimeout(function(){\n                    modal.destroy();\n                    }, 1000);\n                    }.bind(this));\n\n                    this.modal.setBody(this.getBody());\n                    // Forms are big, we want a big modal.\n                    this.modal.setLarge();\n                    if (this.level == 'c') {\n                        var submitlabel = strings[1];\n                    } else if (this.level == 'u') {\n                        var submitlabel = strings[1];\n                    }\n\n                    this.modal.setSaveButtonText(submitlabel);\n                    // We catch the modal save event, and use it to submit the form inside the modal.\n                    // Triggering a form submission will give JS validation scripts a chance to check for errors.\n                    this.modal.getRoot().on(ModalEvents.save, this.submitForm.bind(this));\n                    // We also catch the form submit event and use it to submit the form with ajax.\n                    this.modal.getRoot().on('submit', 'form', this.submitFormAjax.bind(this));\n                \n                }\n                this.modal.show();\n                this.modal.getRoot().animate({\"right\":\"0%\"}, 500);\n\n            }.bind(this));\n\n        };\n        /**\n         * [getStrings description]\n         * @method getStrings\n         * @param  {[type]}   StringData [description]\n         * @return {[type]}              [description]\n         */\n        Fragment.prototype.getStrings = function() {\n            var self = this;\n            var StringData = this.requiredStrings();\n            var RequiredStrings = [];\n            var i = 0;\n            $.each (StringData, function(key, value) {\n                RequiredStrings[i] = {key: key, component: self.pluginname, param: value};\n                i++;\n            });\n            var stringsPromise = Str.get_strings(RequiredStrings);\n            return stringsPromise;\n        };\n\n        /**\n         * @method getBody\n         * @private\n         * @return {Promise}\n         */\n        Fragment.prototype.getBody = function(formdata) {\n            if (typeof formdata === \"undefined\") {\n                formdata = {};\n            }\n\n            this.custommethod=this.method;\n            // Get the content of the modal.\n            this.args.jsonformdata = JSON.stringify(formdata);\n            return fragment.loadFragment(this.pluginname, this.custommethod, this.contextid, this.args);\n        };\n        /**\n        * @method getFooter\n        * @private\n        * @return {Promise}\n        */\n        Fragment.prototype.getFooter = function() {\n\n            $footer = '<button type=\"button\" class=\"btn btn-secondary\" data-action=\"cancel\" style=\"display:none;\">Close</button>';\n        return $footer;\n        };\n\n        /**\n         * @method handleFormSubmissionResponse\n         * @private\n         * @return {Promise}\n         */\n        Fragment.prototype.handleFormSubmissionResponse = function() {\n            this.modal.hide();\n            this.modal.destroy();\n            // We could trigger an event instead.\n            // Yuk.\n            Y.use('moodle-core-formchangechecker', function() {\n                M.core_formchangechecker.reset_form_dirty_state();\n            });\n\n            var PluginModule = require(this.pluginname  + '/' + this.pluginname.split('_')[1]);\n\n            if (typeof PluginModule.childform === 'function') {\n                PluginModule.childform(this);\n            } else {\n                this.handleNotifications('success', {});\n            }\n        };\n\n        /**\n         * @method handleFormSubmissionFailure\n         * @private\n         * @return {Promise}\n         */\n        Fragment.prototype.handleFormSubmissionFailure = function(data) {\n            // Oh noes! Epic fail :(\n            // Ah wait - this is normal. We need to re-display the form with errors!\n            this.modal.setBody(this.getBody(data));\n        };\n\n        /**\n         * Private method\n         *\n         * @method submitFormAjax\n         * @private\n         * @param {Event} e Form submission event.\n         */\n        Fragment.prototype.submitFormAjax = function(e) {\n            // We don't want to do a real form submission.\n            e.preventDefault();\n\n            // Convert all the form elements values to a serialised string.\n            var formData = this.modal.getRoot().find('form').serialize();\n            this.args.jsonformdata = JSON.stringify(formData);\n            \n \n            this.custommethod=this.method;\n            \n            // Now we can continue...\n            var value=Ajax.call([{\n                methodname: 'blocks_trainerdashboard' + '_' + this.custommethod,\n                args: this.args,\n                done: this.handleFormSubmissionResponse.bind(this, formData),\n                fail: this.handleFormSubmissionFailure.bind(this, formData)\n            }]);\n            var body = $('[data-region=\"body\"]');\n            var TEMPLATES = {\n                LOADING: 'core/loading',\n                BACKDROP: 'core/modal_backdrop',\n            };\n            if (value[0].state() == 'pending') {\n                // We're still waiting for the body promise to resolve so\n                // let's show a loading icon.\n                var height = body.innerHeight();\n                if (height < 100) {\n                    height = 100;\n                }\n\n                body.animate({height: height + 'px'}, 150);\n\n                body.html('');\n                contentPromise = Templates.render(TEMPLATES.LOADING, {})\n                    .then(function(html) {\n                        var loadingIcon = $(html).hide();\n                        body.html(loadingIcon);\n                        loadingIcon.fadeIn(150);\n\n                        // We only want the loading icon to fade out\n                        // when the content for the body has finished\n                        // loading.\n                        return $.when(loadingIcon.promise(), value);\n                    })\n                    .then(function(loadingIcon) {\n                        // Once the content has finished loading and\n                        // the loading icon has been shown then we can\n                        // fade the icon away to reveal the content.\n                        return loadingIcon.promise();\n                    })\n                    .then(function() {\n                        return value;\n                    });\n            }\n        };\n\n        /**\n         * This triggers a form submission, so that any mform elements can do final tricks before the form submission is processed.\n         *\n         * @method submitForm\n         * @param {Event} e Form submission event.\n         * @private\n         */\n        Fragment.prototype.submitForm = function(e) {\n            e.preventDefault();\n            this.modal.getRoot().find('form').submit();\n        };\n\n        /**\n         * [requiredStrings description]\n         * @method requiredStrings\n         * @return {[type]}        [description]\n         */\n        Fragment.prototype.requiredStrings = function() {\n            var StringData = {};\n            var PluginModule = require(this.pluginname  + '/' + this.pluginname.split('_')[1]);\n            if (typeof PluginModule.requiredStrings === 'function') {\n                StringData = PluginModule.requiredStrings(this);\n            }\n            this.strings = StringData;\n            return StringData;\n        };\n    return {\n        init: function() {\n            $(document).on('click', SELECTORS.ELEMENT, function(e) {\n                e.preventDefault();\n                var fgelement = $(this);\n                new Fragment(fgelement);\n            });\n        },\n    };\n});"],"file":"fragment.min.js"}