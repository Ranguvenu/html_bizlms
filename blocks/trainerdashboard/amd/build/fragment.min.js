define ("block_trainerdashboard/fragment",["jquery","core/str","core/modal_factory","core/modal_events","core/fragment","core/ajax","core/yui","core/templates","core/notification","core/custom_interaction_events","block_trainerdashboard/trainerdashboard"],function(a,b,c,d,e,f,g,h){var i={ELEMENT:"[data-fg]"},j={ELEFG:"fg",PLUGIN:"plugin",METHOD:"method",PARAMS:"params",TRIGGERTYPE:"triggertype",JSONFORMDATA:"jsonformdata"},k=function(a){this.contextid=M.cfg.contextid;this.fgelement=a;this.id=a.data("id")||0;this.pluginname=a.data(j.PLUGIN);this.method=a.data(j.METHOD);this.level=a.data(j.ELEFG);this.args={};this.args.contextid=this.contextid;this.args.id=this.id;var b={};if("undefined"!=typeof a.data(j.PARAMS)){b=a.data(j.PARAMS)}if("undefined"!=typeof a.data(j.JSONFORMDATA)){this.args.jsonformdata=JSON.stringify(a.data(j.JSONFORMDATA))}this.args.params=JSON.stringify(b);this.args.triggertype=a.data(j.TRIGGERTYPE);this.init()};k.prototype.contextid=-1;k.prototype.id=0;k.prototype.level="c";k.prototype.strings={};k.prototype.args={};k.prototype.init=function(){var b=this,e=this.getStrings(),f=c.types.SAVE_CANCEL;if("r"==b.level){f=c.types.DEFAULT}if("vmtotaltrainings"==b.level||"vmcmpltdtrainings"==b.level||"vmupcmngtrainings"==b.level){var g=c.create({type:c.types.DEFAULT,footer:this.getFooter()})}else{var g=c.create({type:f})}a.when(e,g).then(function(a,c){this.modal=c;this.modal.setTitle(a[0]);if("r"==b.level){this.modal.setBody(this.getBody());this.modal.setLarge();this.modal.getRoot().on(d.hidden,function(){this.modal.destroy()}.bind(this))}else if("vmtotaltrainings"==b.level||"vmcmpltdtrainings"==b.level||"vmupcmngtrainings"==b.level){this.modal.setBody(this.getBody());this.modal.setLarge();this.modal.getRoot().on(d.hidden,function(){this.modal.destroy()}.bind(this))}else{b.modal.getRoot().addClass("openLMStransition");this.modal.getRoot().on(d.hidden,function(){this.modal.getRoot().animate({right:"-85%"},500);setTimeout(function(){c.destroy()},1e3)}.bind(this));this.modal.setBody(this.getBody());this.modal.setLarge();if("c"==this.level){var e=a[1]}else if("u"==this.level){var e=a[1]}this.modal.setSaveButtonText(e);this.modal.getRoot().on(d.save,this.submitForm.bind(this));this.modal.getRoot().on("submit","form",this.submitFormAjax.bind(this))}this.modal.show();this.modal.getRoot().animate({right:"0%"},500)}.bind(this))};k.prototype.getStrings=function(){var c=this,d=this.requiredStrings(),e=[],f=0;a.each(d,function(a,b){e[f]={key:a,component:c.pluginname,param:b};f++});var g=b.get_strings(e);return g};k.prototype.getBody=function(a){if("undefined"==typeof a){a={}}this.custommethod=this.method;this.args.jsonformdata=JSON.stringify(a);return e.loadFragment(this.pluginname,this.custommethod,this.contextid,this.args)};k.prototype.getFooter=function(){$footer="<button type=\"button\" class=\"btn btn-secondary\" data-action=\"cancel\" style=\"display:none;\">Close</button>";return $footer};k.prototype.handleFormSubmissionResponse=function(){this.modal.hide();this.modal.destroy();g.use("moodle-core-formchangechecker",function(){M.core_formchangechecker.reset_form_dirty_state()});var a=require(this.pluginname+"/"+this.pluginname.split("_")[1]);if("function"==typeof a.childform){a.childform(this)}else{this.handleNotifications("success",{})}};k.prototype.handleFormSubmissionFailure=function(a){this.modal.setBody(this.getBody(a))};k.prototype.submitFormAjax=function(b){b.preventDefault();var c=this.modal.getRoot().find("form").serialize();this.args.jsonformdata=JSON.stringify(c);this.custommethod=this.method;var d=f.call([{methodname:"blocks_trainerdashboard_"+this.custommethod,args:this.args,done:this.handleFormSubmissionResponse.bind(this,c),fail:this.handleFormSubmissionFailure.bind(this,c)}]),e=a("[data-region=\"body\"]");if("pending"==d[0].state()){var g=e.innerHeight();if(100>g){g=100}e.animate({height:g+"px"},150);e.html("");contentPromise=h.render({LOADING:"core/loading",BACKDROP:"core/modal_backdrop"}.LOADING,{}).then(function(b){var c=a(b).hide();e.html(c);c.fadeIn(150);return a.when(c.promise(),d)}).then(function(a){return a.promise()}).then(function(){return d})}};k.prototype.submitForm=function(a){a.preventDefault();this.modal.getRoot().find("form").submit()};k.prototype.requiredStrings=function(){var a={},b=require(this.pluginname+"/"+this.pluginname.split("_")[1]);if("function"==typeof b.requiredStrings){a=b.requiredStrings(this)}this.strings=a;return a};return{init:function init(){a(document).on("click",i.ELEMENT,function(b){b.preventDefault();var c=a(this);new k(c)})}}});
//# sourceMappingURL=fragment.min.js.map
